<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HOSH | Skin Processor V2L</title>
<style>
    body { font-family: Arial, sans-serif; background:#1e1e1e; color:#fff; text-align:center; padding:20px; }
    h1 { color: #00ffff; }
    .panel { border: 2px solid #00ffff; padding: 20px; margin-bottom: 20px; border-radius: 10px; }
    table { border-collapse: collapse; margin: 0 auto; width: 80%; }
    th, td { border: 1px solid #fff; padding: 8px; }
    th { background:#333; }
    .bar { display:inline-block; height:12px; background:#00ffff; margin-right:2px; }
    .file-input { margin-bottom:20px; }
    .btn { padding: 8px 12px; margin: 5px; border:none; border-radius:5px; cursor:pointer; font-size: 12px; }
    .btn-download { background: #28a745; color: #fff; }
    .btn-disabled { background: #888; color: #ccc; cursor: not-allowed; }
</style>
</head>
<body>

<div class="panel">
    <h1>HOSH | SKIN PROCESSOR</h1>
    <p>DM Telegram @fireHsoh</p>
</div>

<input type="file" id="fileInput" class="file-input" accept=".txt">
<button onclick="processFile()">Process</button>

<div id="summary"></div>
<div id="distribution"></div>
<div id="v2lDistribution"></div>
<div id="downloadSection"></div>

<script>
function processFile() {
    const fileInput = document.getElementById('fileInput');
    if (!fileInput.files.length) {
        alert("Please select a .txt file!");
        return;
    }

    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
        const content = e.target.result;
        parseBlocks(content);
    };
    reader.readAsText(file);
}

function parseBlocks(text) {
    const DECORATION_CHARS = "═╔╗║╝╚";
    const SKIN_REGEX = /Skins\s*[:=]?\s*(\d+)/i;
    const V2L_REGEX = /V2L\s*[:=]\s*(Yes|No)/i;
    const LOGIN_REGEX = /Last Login:\s*(\d{4}-\d{2}-\d{2})/;
    const V2L_THRESHOLD = 650;

    const blocks = text.split(/\n\s*\n/).map(b => b.trim()).filter(b => b);
    const valid = [];
    const trash = [];
    const now = Date.now();

    blocks.forEach(block => {
        const lines = block.split("\n").filter(l => l.trim() && ![...DECORATION_CHARS].some(c => l.includes(c)));
        const joined = lines.join("\n");

        const skinMatch = SKIN_REGEX.exec(joined);
        const loginMatch = LOGIN_REGEX.exec(joined);
        const v2lMatch = V2L_REGEX.exec(joined);

        if (skinMatch && parseInt(skinMatch[1]) >= 100) {
            let status = "Unknown";
            if (loginMatch) {
                const lastLogin = new Date(loginMatch[1]);
                const diffDays = (now - lastLogin.getTime()) / (1000*60*60*24);
                status = diffDays <= 3 ? "Active" : "Inactive";
            }
            const skinVal = parseInt(skinMatch[1]);
            const isV2L = v2lMatch ? v2lMatch[1].toLowerCase() === 'yes' : skinVal > V2L_THRESHOLD;
            valid.push({ skin: skinVal, text: joined, status, v2l: isV2L });
        } else {
            trash.push(joined);
        }
    });

    showSummary(valid, trash, blocks.length);
    generateDownloadLinks(valid);
}

function showSummary(valid, trash, total) {
    const counts = valid.map(v => v.skin);
    const avg = counts.length ? (counts.reduce((a,b)=>a+b,0)/counts.length).toFixed(1) : 0;
    const min = counts.length ? Math.min(...counts) : "-";
    const max = counts.length ? Math.max(...counts) : "-";
    const activeCount = valid.filter(v => v.status === "Active").length;
    const inactiveCount = valid.filter(v => v.status === "Inactive").length;

    const summaryDiv = document.getElementById("summary");
    summaryDiv.innerHTML = `
        <div class="panel">
        <h2>Summary</h2>
        <p>Total Accounts: ${total}</p>
        <p>Valid Accounts: ${valid.length}</p>
        <p>Active Accounts: ${activeCount}</p>
        <p>Inactive Accounts: ${inactiveCount}</p>
        <p>Min Skins: ${min}</p>
        <p>Max Skins: ${max}</p>
        <p>Average Skins: ${avg}</p>
        <p>Trash Count: ${trash.length}</p>
        </div>
    `;

    showDistribution(valid);
    showV2LDistribution(valid);
}

function showDistribution(valid) {
    const ranges = {
        "100–200": [100,200],
        "201–300": [201,300],
        "301–400": [301,400],
        "401–500": [401,500],
        "501–600": [501,600],
        "601–700": [601,700],
    };

    const buckets = {};
    for (let r in ranges) buckets[r] = 0;

    valid.forEach(v => {
        for (let r in ranges) {
            const [lo, hi] = ranges[r];
            if (v.skin >= lo && v.skin <= hi) buckets[r]++;
        }
    });

    const distributionDiv = document.getElementById("distribution");
    let html = `<h2>Skin Count Distribution</h2><table><tr><th>Range</th><th>Count</th><th>%</th><th>Bar</th></tr>`;
    const totalValid = valid.length;
    for (let r in buckets) {
        const cnt = buckets[r];
        const pct = totalValid ? Math.round((cnt/totalValid)*100) : 0;
        const bar = '█'.repeat(Math.round(pct/5)) + '░'.repeat(20-Math.round(pct/5));
        html += `<tr><td>${r}</td><td>${cnt}</td><td>${pct}%</td><td>${bar}</td></tr>`;
    }
    html += "</table>";
    distributionDiv.innerHTML = html;
}

function showV2LDistribution(valid) {
    const counts = { Yes: 0, No: 0 };
    valid.forEach(v => counts[v.v2l ? 'Yes' : 'No']++);
    const total = valid.length;
    const v2lDiv = document.getElementById("v2lDistribution");

    let html = `<h2>V2L Distribution</h2><table><tr><th>V2L</th><th>Count</th><th>%</th><th>Bar</th></tr>`;
    for (let key in counts) {
        const cnt = counts[key];
        const pct = total ? Math.round((cnt/total)*100) : 0;
        const bar = '█'.repeat(Math.round(pct/5)) + '░'.repeat(20-Math.round(pct/5));
        html += `<tr><td>${key}</td><td>${cnt}</td><td>${pct}%</td><td>${bar}</td></tr>`;
    }
    html += "</table>";
    v2lDiv.innerHTML = html;
}

// Generate download links
function generateDownloadLinks(valid) {
    const section = document.getElementById("downloadSection");
    section.innerHTML = "<h2>Downloads</h2>";

    // Valid accounts (non-V2L only)
    const nonV2L = valid.filter(v => !v.v2l);
    if(nonV2L.length) {
        const hitsContent = nonV2L.map(v => v.text + "\n---").join("\n");
        const hitsBlob = new Blob([hitsContent], {type: 'text/plain'});
        const hitsUrl = URL.createObjectURL(hitsBlob);

        const hitsBtn = document.createElement('a');
        hitsBtn.textContent = "Download Valid Accounts";
        hitsBtn.href = hitsUrl;
        hitsBtn.download = "Hits.txt";
        hitsBtn.className = "btn btn-download";
        section.appendChild(hitsBtn);
    }

    // 200+ Skins download (non-V2L only)
    const highSkins = nonV2L.filter(v => v.skin >= 200);
    if(highSkins.length) {
        const highContent = highSkins.map(v => v.text + "\n---").join("\n");
        const highBlob = new Blob([highContent], {type: 'text/plain'});
        const highUrl = URL.createObjectURL(highBlob);

        const highBtn = document.createElement('a');
        highBtn.textContent = "Download 200+ Skins";
        highBtn.href = highUrl;
        highBtn.download = "Skins200.txt";
        highBtn.className = "btn btn-download";
        section.appendChild(highBtn);
    }
}
</script>

</body>
</html>
