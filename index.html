<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HOSH | Skin Processor V2L</title>
<style>
    body { font-family: Arial, sans-serif; background:#1e1e1e; color:#fff; text-align:center; padding:20px; }
    h1 { color: #00ffff; }
    .panel { border: 2px solid #00ffff; padding: 20px; margin-bottom: 20px; border-radius: 10px; }
    table { border-collapse: collapse; margin: 0 auto; width: 80%; }
    th, td { border: 1px solid #fff; padding: 8px; }
    th { background:#333; }
    .bar { display:inline-block; height:12px; background:#00ffff; margin-right:2px; }
    .v2l-bar-yes { background:#ff5555; height:12px; display:inline-block; margin-right:2px; }
    .v2l-bar-no { background:#28a745; height:12px; display:inline-block; margin-right:2px; }
    .file-input { margin-bottom:20px; }
    .btn { padding: 10px 15px; margin: 5px; border:none; border-radius:5px; cursor:pointer; }
    .btn-download { background: #28a745; color: #fff; }
    .btn-disabled { background: #888; color: #ccc; cursor: not-allowed; }
    .v2l { color: #ff5555; font-weight:bold; }
</style>
</head>
<body>

<div class="panel">
    <h1>HOSH | SKIN PROCESSOR</h1>
    <p>DM Telegram @fireHsoh</p>
</div>

<input type="file" id="fileInput" class="file-input" accept=".txt">
<button onclick="processFile()">Process</button>

<div id="summary"></div>
<div id="distribution"></div>
<div id="downloadSection"></div>

<script>
function processFile() {
    const fileInput = document.getElementById('fileInput');
    if (!fileInput.files.length) {
        alert("Please select a .txt file!");
        return;
    }

    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
        const content = e.target.result;
        parseBlocks(content);
    };
    reader.readAsText(file);
}

function parseBlocks(text) {
    const DECORATION_CHARS = "═╔╗║╝╚";
    const SKIN_REGEX = /skin\s*[:=]?\s*(\d+)/i;
    const LOGIN_REGEX = /Last Log in:\s*(\d{4}-\d{2}-\d{2})/;
    const V2L_THRESHOLD = 650;

    const blocks = text.split(/\n\s*\n/).map(b => b.trim()).filter(b => b);
    const valid = [];
    const now = Date.now();

    blocks.forEach(block => {
        const lines = block.split("\n").filter(l => l.trim() && ![...DECORATION_CHARS].some(c => l.includes(c)));
        const joined = lines.join("\n");

        const skinMatch = SKIN_REGEX.exec(joined);
        const loginMatch = LOGIN_REGEX.exec(joined);

        if (skinMatch && parseInt(skinMatch[1]) >= 100) {
            let status = "Unknown";
            if (loginMatch) {
                const lastLogin = new Date(loginMatch[1]);
                const diffDays = (now - lastLogin.getTime()) / (1000*60*60*24);
                status = diffDays <= 3 ? "Active" : "Inactive";
            }
            const skinVal = parseInt(skinMatch[1]);
            const isV2L = skinVal > V2L_THRESHOLD;
            valid.push({ skin: skinVal, text: joined, status, v2l: isV2L });
        }
    });

    showSummary(valid);
    showDistribution(valid);
    generateDownloadLinks(valid);
}

function showSummary(valid) {
    const counts = valid.map(v => v.skin);
    const avg = counts.length ? (counts.reduce((a,b)=>a+b,0)/counts.length).toFixed(1) : 0;
    const min = counts.length ? Math.min(...counts) : "-";
    const max = counts.length ? Math.max(...counts) : "-";
    const activeCount = valid.filter(v => v.status === "Active").length;
    const inactiveCount = valid.filter(v => v.status === "Inactive").length;

    const v2lYes = valid.filter(v => v.v2l).length;
    const v2lNo = valid.filter(v => !v.v2l).length;
    const total = v2lYes + v2lNo;
    const pctYes = total ? Math.round((v2lYes/total)*100) : 0;
    const pctNo = total ? Math.round((v2lNo/total)*100) : 0;

    const summaryDiv = document.getElementById("summary");
    summaryDiv.innerHTML = `
        <div class="panel">
        <h2>Summary</h2>
        <p>Total Accounts: ${total}</p>
        <p>Active Accounts: ${activeCount}</p>
        <p>Inactive Accounts: ${inactiveCount}</p>
        <p>Min Skins: ${min}</p>
        <p>Max Skins: ${max}</p>
        <p>Average Skins: ${avg}</p>
        <p>V2L Distribution:</p>
        <div style="width:80%; margin:0 auto; background:#333; border-radius:5px; overflow:hidden;">
            <div class="v2l-bar-yes" style="width:${pctYes}%;"></div>
            <div class="v2l-bar-no" style="width:${pctNo}%;"></div>
        </div>
        <p>V2L:Yes ${v2lYes} | V2L:No ${v2lNo}</p>
        </div>
    `;
}

function showDistribution(valid) {
    const ranges = {
        "100–200": [100,200],
        "201–300": [201,300],
        "301–400": [301,400],
        "401–500": [401,500],
        "501–600": [501,600],
        "601–700": [601,700],
    };

    const buckets = {};
    for (let r in ranges) buckets[r] = 0;

    valid.forEach(v => {
        for (let r in ranges) {
            const [lo, hi] = ranges[r];
            if (v.skin >= lo && v.skin <= hi) buckets[r]++;
        }
    });

    const distributionDiv = document.getElementById("distribution");
    let html = `<h2>Skin Count Distribution</h2><table><tr><th>Range</th><th>Count</th><th>%</th><th>Bar</th></tr>`;
    const totalValid = valid.length;
    for (let r in buckets) {
        const cnt = buckets[r];
        const pct = totalValid ? Math.round((cnt/totalValid)*100) : 0;
        const bar = '█'.repeat(Math.round(pct/5)) + '░'.repeat(20-Math.round(pct/5));
        html += `<tr><td>${r}</td><td>${cnt}</td><td>${pct}%</td><td>${bar}</td></tr>`;
    }
    html += "</table>";
    distributionDiv.innerHTML = html;
}

function generateDownloadLinks(valid) {
    const section = document.getElementById("downloadSection");
    section.innerHTML = "<h2>Downloads</h2>";

    const v2lAccounts = valid.filter(v => v.v2l);
    const nonV2lAccounts = valid.filter(v => !v.v2l);

    // V2L notice
    if (v2lAccounts.length) {
        const v2lNotice = document.createElement('p');
        v2lNotice.textContent = `V2L Accounts Detected: ${v2lAccounts.length} → No download allowed`;
        v2lNotice.className = "v2l";
        section.appendChild(v2lNotice);
    }

    // Non-V2L download
    if (nonV2lAccounts.length) {
        const content = nonV2lAccounts.map(v => `[Status: ${v.status}]\n${v.text}\n`).join("\n");
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);

        const btn = document.createElement('a');
        btn.textContent = "Download Non-V2L Accounts";
        btn.href = url;
        btn.download = "NonV2L.txt";
        btn.className = "btn btn-download";

        section.appendChild(btn);
    } else {
        const noFileNotice = document.createElement('p');
        noFileNotice.textContent = "No Non-V2L accounts to download.";
        section.appendChild(noFileNotice);
    }
}
</script>

</body>
</html>
